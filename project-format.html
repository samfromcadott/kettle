<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Tone.js Song</title>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/0.10.0/Tone.min.js" charset="utf-8"></script>
</head>
<body>
	<button id="play-button">&#9658;</button>

	<script>
	Tone.Transport.stop()

	$('#play-button').click( () =>{
		if (Tone.Transport.state == "stopped") {
			Tone.Transport.start()
			$('#play-button').html('&#9724;')
		} else if (Tone.Transport.state == "started") {
			Tone.Transport.stop()
			$('#play-button').html('&#9658;')
		}
	})

	function noteToFreq(note) {
		return 2**((note-69)/12) * 440
	}

	var padSynth = {
		mixer: new Tone.PanVol(0, 0).toMaster(),
		voices: {},
		playNote: function (note, velocity) {
			var newNote = {}

			newNote.inputFreq = new Tone.Signal(noteToFreq(note))
			newNote.osc = new Tone.Oscillator(440, "sawtooth")
			newNote.ampEnv = new Tone.AmplitudeEnvelope()

			newNote.inputFreq.connect(newNote.osc.frequency)
			newNote.osc.connect(newNote.ampEnv)
			newNote.ampEnv.connect(this.mixer)

			newNote.osc.start()
			newNote.ampEnv.triggerAttack(velocity)

			this.voices[note] = newNote
		},
		stopNote: function (note, length) {
			this.voices[note].ampEnv.triggerRelease('+' + length)
		}
	}

	minorScale = [{time: '0:0', length: '4n', note: 57, velocity: 1}, {time: '0:0:3', length: '4n', note: 60, velocity: 1}, {time: '0:0', length: '2n', note: 64, velocity: 1}]

	var padPart = new Tone.Part( (time, value) => {
		padSynth.playNote(value.note, value.velocity)
		padSynth.stopNote(value.note, value.length)
	}, minorScale).start(0)
	</script>
</body>
</html>
